"use strict";const formTask=document.getElementById("formTask"),bgColor=document.getElementById("bgColor"),tasksList=document.getElementById("tasksList"),fragment=document.createDocumentFragment(),validateFields=e=>{for(const t in e)if(e.hasOwnProperty(t)){const s=e[t];if(""===s||void 0===s)return!1}return!0},setIdTask=()=>{const e=getCurrentTime();return`${e.year}${e.month}${e.date}${e.hours}${e.minutes}${e.seconds}`},showMsg=(e,t)=>{const s=document.getElementById(e);s.textContent=t,setTimeout(()=>{s.textContent="Tareas"},2500)},noTasks=e=>{const t=document.createElement("P");t.classList.add("no-task"),t.textContent="No hay tareas que mostrar",e.appendChild(t)},colors={red:formTask.red,yellow:formTask.yellow,green:formTask.green},isColorChecked=()=>{for(const e in colors)if(colors.hasOwnProperty(e)){const t=colors[e];if(t.checked)return t.id}return!1},validateDate=e=>{const t=new Date;return new Date(e)-t>=0},getCurrentTime=()=>{let e=new Date;return{year:e.getFullYear(),month:e.getMonth()+1,date:e.getDate(),hours:("0"+e.getHours()).slice(-2),minutes:("0"+e.getMinutes()).slice(-2),seconds:("0"+e.getSeconds()).slice(-2)}},showCurrentTime=()=>{let e=getCurrentTime();return`Agregada: ${e.date}/${e.month}/${e.year} a las ${e.hours}:${e.minutes}`},getRemainTime=e=>{let t=new Date,s=(new Date(e)-t+1e3)/1e3;return{remainTime:s,seconds:("0"+Math.floor(s%60)).slice(-2),minutes:("0"+Math.floor(s/60%60)).slice(-2),hours:("0"+Math.floor(s/3600%24)).slice(-2),days:Math.floor(s/86400)}},countDown=(e,t)=>{const s=setInterval(()=>{const o=getRemainTime(e);o.remainTime<=1&&clearInterval(s),t&&(t.textContent=`Quedan: ${o.days}d ${o.hours}h ${o.minutes}m ${o.seconds}s`)},1e3)},updateDate=(e,t)=>{const s=document.getElementById(t);if(s){const t=getRemainTime(e);s.textContent=`Quedan: ${t.days}d ${t.hours}h ${t.minutes}m ${t.seconds}s`,countDown(e,s)}},ls=localStorage,setTasks=e=>{ls.setItem(e.id,JSON.stringify(e)),getTasks()},getTasks=()=>{if(removeElems(),0!==ls.length)for(const e in ls)ls.hasOwnProperty(e)&&createTaskElem(JSON.parse(ls.getItem(e)));else noTasks(tasksList)},removeTask=e=>{for(const t in ls)ls.hasOwnProperty(t)&&t===e&&ls.removeItem(t);getTasks()},createElem=(e,t,s,o,a)=>{const r=document.createElement(t.toUpperCase());s.forEach(e=>{r.classList.add(e)}),r.textContent=o,"BUTTON"===r.nodeName&&void 0!==a&&(r.dataset.id=a),"P"===r.nodeName&&void 0!==a&&r.setAttribute("id",a),e.appendChild(r)},createTaskElem=e=>{const t=document.createElement("LI");t.classList.add("tasks__task",""+e.bgColor),createElem(t,"p",["child-one"],""+e.name),createElem(t,"button",["child-two","button","delete"],"Borrar",""+e.id),createElem(t,"p",["child-tree"],""+showCurrentTime()),createElem(t,"p",["child-four"],"",`${e.bgColor}${e.id}`),fragment.appendChild(t),tasksList.appendChild(fragment),updateDate(e.date,`${e.bgColor}${e.id}`)},removeElems=()=>{Array.from(tasksList.children).forEach(e=>{e&&e.remove()})};formTask.addEventListener("submit",e=>{e.preventDefault();const t={id:setIdTask(),name:formTask.inputTask.value.trim(),bgColor:isColorChecked(),date:formTask.inputDate.value};countDown(t.date),validateFields(t)?validateDate(t.date)?setTasks(t):showMsg("msg","La fecha debe ser posterior a hoy"):showMsg("msg","Completa todos los campos"),bgColor.classList.remove("red","yellow","green"),formTask.reset()}),tasksList.addEventListener("click",e=>{removeTask(e.target.dataset.id)}),document.addEventListener("DOMContentLoaded",()=>{getTasks()}),bgColor.addEventListener("click",()=>{bgColor.classList.remove("red","yellow","green"),bgColor.classList.add(isColorChecked())});